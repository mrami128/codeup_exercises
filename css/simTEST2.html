<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

    <style>
        .container {
            width: 430px;
            border: 2px solid green;
            margin-left: 20px;
            padding-left: 25px;
            margin-top: 15px;
            padding-top: 25px;
            padding-bottom: 25px;

        }

        .controlPanel {
            width: 400px;
            text-align: center;
            border: 3px solid green;
        }

        #gameTitle {
            font-size: 48px;
        }

        #start {
            height: 40px;
            width: 90px;
        }

        #hiScore {
            margin-left: 20px;
            margin-bottom: 20px;
            height: 40px;
            width: 90px;
            background-color: lightgrey;
        }

        .box-container { /*THIS is main buttons box- not body -not h1 also opt/sht+up/ dwn moves sel codelines  up or dwn*/
            width: 400px;
            height: 400px;
            border: 3px solid green;
            background-color: black;/* #d3d2be; */
        }

        .box { /*class for each indiv box red blue green  yellow below*/
            width: 115px;
            height: 115px;
            border: 3px solid grey;
            margin-top: 20px;
            margin-left: 15px;
            margin-right: 10px;
            padding: 25px;
            float: left; /* float left gets all the divs to line up sideways until contain full then moves downrow */
            font-size: 14px;
        }

        #red1 {
            background-color: red;
        }

        #green2 {
            background-color: green;
        }

        #blue3 {
            background-color: blue; /* ====clear will move the green box down to nex row--OR can use nth child with pseudo: indicator:*/
            clear: left; /*  .box:nth-child(3), .box:nth-child(5) { clear:left; } */
        }

        #yellow4 {
            background-color: #ffc455;
        }
    </style>

</head>
<body>

<div class="container">

    <div class="controlPanel">
        <h1 id="gameTitle"> Simon Game </h1>

        <h3 id="level">Click Start. <br>Watch the pattern. <br>Then click buttons to match the pattern</h3>

        <button id="start">Start Game</button>
        <button id="hiScore">Hi Score</button>
    </div>

    <div class="box-container">
        <div id="red1" class="box" data-num="1"> </div>
        <div id="green2" class="box" data-num="2"> </div>
        <div id="blue3" class="box" data-num="3"> </div>
        <div id="yellow4" class="box" data-num="4"> </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-2.2.4.js"
        integrity="sha256-iT6Q9iMJYuQiMWNd9lDyBUStIq/8PuOW33aOqmvFpqI="
        crossorigin="anonymous"></script>


<script>  // ===============Jquery =================

$(document).ready(function () {
    "use strict";


// ======= Variable List ===================

    var simonArr = [];
    var marcArr = [];
    var level = 0;
    var newNum = 0;

// ======= function list ===================

    function youWin() {
        $('#level').html('YOU WIN !! Level: ' + level);
    };

    function youLose() {
        start();
        $('#level').html('YOU LOSE !! Level: ' + level);
    };

    function flasher(element) {
        $(element)
            .animate({opacity: .40}, 150)
            .animate({opacity: 1}, 150);
//        console.log('flasher func activated');
    }

    function getNextNum() {

        var newNum = Math.floor((Math.random() * 4) + 1);

        simonArr.push(newNum);  //==== push this new number onto end of simonArr

             // ==== simonArr info =============================
             //        console.log("number at index:" + i + " is " + simonArr[i]);
             //        console.log('  simonArr consist of these numbers:' + simonArr);
             //        console.log('    length is: ' + simonArr.length);
    }

    function resetGame() {
        simonArr = [];
        marcArr = [];
        level = 0;
        nextRound();
    }

// ===== control panel button clicks ==============

    $('#hiScore').click(function () {
        alert('Simon has the Hi score');
        youLose();
    });

    function start() {
        $('#start').on('click', function () {
            resetGame();
            $('#start').off('click');   //turns off start button til game ends
        });
    }
//=================================================

    function nextRound() {

        level++;   //if new game then level goes from 0to1.

        if (level >= 21) {

            youWin();

        } else {

            $('#level').html('Level: ' + level);

            getNextNum();     // get next random number

            blinkAction();    // blink the code of simonArr
        }
    }

// ==== user Clicks and Compare Action =============

    function userInput() {
        var i = 0;
        $('.box').on('click', function () {         // turn on the click listener so user can click

            //===== xx ===== xx ==== xx == when user clicks Flash doesnt work and blink causes DOUBLE flashing of simonArr code

            var btnValue = $(this).attr('data-num');

            if (btnValue == simonArr[i]) {          // compares user click to single simonArr element then cycles through

                if (i == simonArr.length - 1) {
                    nextRound();

                    $('#level').html('You are on Level: ' +level );

                    $('.box').off('click');        // turn off the click listener while game is presenting the simon array

                } else {
                    i++;                           // cycle back to top for next user click check agnst simonArr
                }
            } else {                               // if user doesnt match simonArr-- turn off click and call youLose()
                $('.box').off('click');
                youLose();
            }
        });
    }

// === Light up buttons for simonArr -use Switch Case ===== set some delaytime  and then light the button for user.

    function blinkAction() {
        var i = 0;
        var intervalId = setInterval(function () {
            switch (simonArr[i]) {

                case 1:
                    console.log("activate red1");
                    flasher('#red1');
                    break;

                case 2:
                    console.log("activate green2 ");
                    flasher('#green2');
                    break;

                case 3:
                    console.log("activate blue3 ");
                    flasher('#blue3');
                    break;

                case 4:
                    console.log("activate yellow4 ");
                    flasher('#yellow4');
                    break;

                default:
                    youLose();
                    console.log("SYSTEM ERROR goto game over function");
            }  //end of switch cases
            if (i >= simonArr.length - 1) {
                userInput();
                clearInterval(intervalId);
            } else {
                i++;
            }
        }, 400);
    } //end of blink action
    start();

}); // this is end of iffe
</script>

</body>
</html>